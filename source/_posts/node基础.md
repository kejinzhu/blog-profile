---
title: node基础
copyright: true
date: 2018-08-17 15:56:44
categories: 
          - node 
          - 后端
tags: 
    - node 
---

# node的基本概念

## node能够解决什么问题？
- node的首要目标是提供一种简单的，用于创建高性能的服务器的开发工具
- web服务器的瓶颈在于并发的用户量，对比Java和PHP的实现方式
<!-- more -->

![PHP的实现方式](/images/php.png)
![node的实现方式](/images/node.png)

## node是什么？
- node.js是一个基于Chrome V8引擎的JavaScript运行环境，让JavaScript的执行效率与低端的C语言的相近的执行效率
- node.js使用了一个事件驱动、非阻塞式I/O的模型，使其轻量又高效
- node.js的包管理器npm，是全球最大的开源生态系统

## node的特点
### 为什么JavaScript是单线程的

- 这是由JavaScript这门脚本语言的用途决定的
- Web Worker并没用改变JavaScript单线程的本质

### 浏览器模型

- 用户界面包括地址栏、前进/后退按钮、书签菜单等
- 浏览器引擎-在用户界面和呈现引擎之间传送指令
- 呈现引擎-又称渲染引擎，也被称为浏览器内核，在线程方面又称为UI线程
- 网络-用于网络调用，比如http请求
- 用户界面后端-用于绘制基本的窗口小部件，UI线程和JS共用一个线程
- JavaScript解释器-用于解析和执行JavaScript代码
- 数据存储-这是持久层。浏览器需要在硬盘上保存各种数据，例如Cookie

### Webworker

- 是多线程的
- 完全受主线程控制
- 不能操作DOM

### 除JS线程和UI线程之外的其他线程

### 任务队列
### Event Loop(事件循环)

```javascript
function read(){
 console.log(1);
 setTimeout(function(){
 console.log(2);
 setTimeout(function(){
 console.log(4);
 },1000)
 },1000);//放到事件队列里
 setTimeout(function(){
 console.log(5);
 },1000)
 console.log(3);
}
read();//依次打印1 3 2 5 4
//JS引擎会先执行栈中的任务，再执行回调队列中的回调事件（先进先出）
```

```javascript
function next(){
console.log(1);
setTimrout(function(){
console.log(2);
});
//nextTick是把这个回调函数当在当前执行栈的尾部
process.nextTick(function(){
console.log(3);
process.nextTick(function(){
console.log(4);
process.nextTick(function(){
console.log(5);
})// 1 3 4 5 2 
})
})
}
next();//1 3 4 5 2
```

### node.js中的Event Loop

- V8引擎解析JavaScript脚本
- 解析后的代码，调用node API
- libuv库负责node API的执行，它将不同的任务分配给不同的线程，形成一个Event Loop(事件环)，以异步的方式将任务的执行结果返回给V8引擎
- V8引擎再将结果返回给用户

### 同步与异步
同步和异步关注的是消息通知机制

- 同步就是发出调用后，没有得到结果之前，该调用不返回，一旦返回，就得到返回值了，简而言之就是调用者主动等待这个调用的结果
- 异步则相反，调用者在发出后这个调用就直接返回了，所以没有返回结果。换句话说当一个异步过程调用发出后，调用者不会立刻得到结果，而是调用发出后，被调用者通过状态、通知或回调函数处理这个调用。

### 阻塞与非阻塞
阻塞和非阻塞关注的是等待结果时的状态

- 阻塞调用是指调用结果返回之前，当前线程会被挂起。调用线程只有在得到结果之后才会返回。
- 非阻塞调用指在不能立刻得到结果之前，该调用不会阻塞当前线程。

### 同步异步与阻塞非阻塞的区别

同步异步取决于被调用者，阻塞非阻塞取决于调用者
被调用者决定的是同步还是异步
调用者决定是阻塞还是非阻塞
调用者在等待的过程中不干别的，那就是调用者被阻塞了
调用者在等待的过程中干别的，那就是调用者不被阻塞

### 同异步与阻塞非阻塞的组合关系

- 同步阻塞

被调用者立即告诉调用者是同步的，这个等待过程中调用者不干别的，就是调用者被阻塞了。

- 同步非阻塞

被调用者立即告诉调用者是同步的，这个等待过程中调用者接着干其他的，主线程不受干扰，就是调用者不被阻塞。

- 异步阻塞

被调用者是异步的，但是这个等待过程中调用者不干别的，就调用者被阻塞了。这是异步阻塞

- 异步非阻塞

被调用者是异步的，这个等待的过程中调用者接着干其他的事情，主线程不受干扰，调用者不被阻塞，这就是异步非阻塞。

## 什么场景下应该考虑使用node框架

当应用程序需要处理大量并发的输入输出，而在向客户端响应之前，应用程序并不需要进行非常复杂的处理。

- 聊天服务器
- 电子商务网站

